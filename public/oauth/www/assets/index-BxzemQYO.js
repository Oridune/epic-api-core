import{c as S,g as pe}from"./index-CPDUBjbG.js";function ge(f,i){for(var t=0;t<i.length;t++){const e=i[t];if(typeof e!="string"&&!Array.isArray(e)){for(const n in e)if(n!=="default"&&!(n in f)){const o=Object.getOwnPropertyDescriptor(e,n);o&&Object.defineProperty(f,n,o.get?o:{enumerable:!0,get:()=>e[n]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}var re=[],ye=re.forEach,ve=re.slice;function T(f){return ye.call(ve.call(arguments,1),function(i){if(i)for(var t in i)f[t]===void 0&&(f[t]=i[t])}),f}function we(f,i,t){var e;return function(){var n=this,o=arguments,s=function(){e=null,f.apply(n,o)};clearTimeout(e),e=setTimeout(s,i)}}function G(f,i,t){function e(s){return s&&s.indexOf("###")>-1?s.replace(/###/g,"."):s}for(var n=typeof i!="string"?[].concat(i):i.split(".");n.length>1;){if(!f)return{};var o=e(n.shift());!f[o]&&t&&(f[o]=new t),f=f[o]}return f?{obj:f,k:e(n.shift())}:{}}function C(f,i,t){var e=G(f,i,Object),n=e.obj,o=e.k;n[o]=t}function me(f,i,t,e){var n=G(f,i,Object),o=n.obj,s=n.k;o[s]=o[s]||[],o[s].push(t)}function V(f,i){var t=G(f,i),e=t.obj,n=t.k;if(e)return e[n]}var $=new RegExp("{{(.+?)}}","g");function be(f){return f==null?"":""+f}function I(f,i,t){var e,n;function o(s){return s.replace(/\$/g,"$$$$")}for(;e=$.exec(f);)n=e[1].trim(),typeof n!="string"&&(n=be(n)),n||(n=""),n=o(n),f=f.replace(e[0],i[n]||n),$.lastIndex=0;return f}function q(f,i){return i.reduce(function(t,e){if(t)return t;if(!f||!f[e]||typeof f[e]!="string"||!f[e].toLowerCase()===e.toLowerCase()){var n='i18next-locize-backend :: got "'.concat(f[e],'" in options for ').concat(e," which is invalid.");return console.warn(n),n}return!1},!1)}function Q(){var f,i,t=new Promise(function(e,n){f=e,i=n});return t.resolve=f,t.reject=i,t}function Ee(f){throw new Error('Could not dynamically require "'+f+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var B={exports:{}},D={exports:{}},Y;function je(){return Y||(Y=1,function(f,i){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof S<"u"&&S,e=function(){function o(){this.fetch=!1,this.DOMException=t.DOMException}return o.prototype=t,new o}();(function(o){(function(s){var c=typeof o<"u"&&o||typeof self<"u"&&self||typeof c<"u"&&c,u={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function h(r){return r&&DataView.prototype.isPrototypeOf(r)}if(u.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(r){return r&&d.indexOf(Object.prototype.toString.call(r))>-1};function p(r){if(typeof r!="string"&&(r=String(r)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(r)||r==="")throw new TypeError('Invalid character in header field name: "'+r+'"');return r.toLowerCase()}function y(r){return typeof r!="string"&&(r=String(r)),r}function E(r){var a={next:function(){var g=r.shift();return{done:g===void 0,value:g}}};return u.iterable&&(a[Symbol.iterator]=function(){return a}),a}function v(r){this.map={},r instanceof v?r.forEach(function(a,g){this.append(g,a)},this):Array.isArray(r)?r.forEach(function(a){this.append(a[0],a[1])},this):r&&Object.getOwnPropertyNames(r).forEach(function(a){this.append(a,r[a])},this)}v.prototype.append=function(r,a){r=p(r),a=y(a);var g=this.map[r];this.map[r]=g?g+", "+a:a},v.prototype.delete=function(r){delete this.map[p(r)]},v.prototype.get=function(r){return r=p(r),this.has(r)?this.map[r]:null},v.prototype.has=function(r){return this.map.hasOwnProperty(p(r))},v.prototype.set=function(r,a){this.map[p(r)]=y(a)},v.prototype.forEach=function(r,a){for(var g in this.map)this.map.hasOwnProperty(g)&&r.call(a,this.map[g],g,this)},v.prototype.keys=function(){var r=[];return this.forEach(function(a,g){r.push(g)}),E(r)},v.prototype.values=function(){var r=[];return this.forEach(function(a){r.push(a)}),E(r)},v.prototype.entries=function(){var r=[];return this.forEach(function(a,g){r.push([g,a])}),E(r)},u.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function j(r){if(r.bodyUsed)return Promise.reject(new TypeError("Already read"));r.bodyUsed=!0}function L(r){return new Promise(function(a,g){r.onload=function(){a(r.result)},r.onerror=function(){g(r.error)}})}function oe(r){var a=new FileReader,g=L(a);return a.readAsArrayBuffer(r),g}function se(r){var a=new FileReader,g=L(a);return a.readAsText(r),g}function ae(r){for(var a=new Uint8Array(r),g=new Array(a.length),m=0;m<a.length;m++)g[m]=String.fromCharCode(a[m]);return g.join("")}function J(r){if(r.slice)return r.slice(0);var a=new Uint8Array(r.byteLength);return a.set(new Uint8Array(r)),a.buffer}function K(){return this.bodyUsed=!1,this._initBody=function(r){this.bodyUsed=this.bodyUsed,this._bodyInit=r,r?typeof r=="string"?this._bodyText=r:u.blob&&Blob.prototype.isPrototypeOf(r)?this._bodyBlob=r:u.formData&&FormData.prototype.isPrototypeOf(r)?this._bodyFormData=r:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(r)?this._bodyText=r.toString():u.arrayBuffer&&u.blob&&h(r)?(this._bodyArrayBuffer=J(r.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(r)||l(r))?this._bodyArrayBuffer=J(r):this._bodyText=r=Object.prototype.toString.call(r):this._bodyText="",this.headers.get("content-type")||(typeof r=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(r)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var r=j(this);if(r)return r;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var r=j(this);return r||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(oe)}),this.text=function(){var r=j(this);if(r)return r;if(this._bodyBlob)return se(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ae(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(ce)}),this.json=function(){return this.text().then(JSON.parse)},this}var fe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ue(r){var a=r.toUpperCase();return fe.indexOf(a)>-1?a:r}function A(r,a){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');a=a||{};var g=a.body;if(r instanceof A){if(r.bodyUsed)throw new TypeError("Already read");this.url=r.url,this.credentials=r.credentials,a.headers||(this.headers=new v(r.headers)),this.method=r.method,this.mode=r.mode,this.signal=r.signal,!g&&r._bodyInit!=null&&(g=r._bodyInit,r.bodyUsed=!0)}else this.url=String(r);if(this.credentials=a.credentials||this.credentials||"same-origin",(a.headers||!this.headers)&&(this.headers=new v(a.headers)),this.method=ue(a.method||this.method||"GET"),this.mode=a.mode||this.mode||null,this.signal=a.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&g)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(g),(this.method==="GET"||this.method==="HEAD")&&(a.cache==="no-store"||a.cache==="no-cache")){var m=/([?&])_=[^&]*/;if(m.test(this.url))this.url=this.url.replace(m,"$1_="+new Date().getTime());else{var b=/\?/;this.url+=(b.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function ce(r){var a=new FormData;return r.trim().split("&").forEach(function(g){if(g){var m=g.split("="),b=m.shift().replace(/\+/g," "),w=m.join("=").replace(/\+/g," ");a.append(decodeURIComponent(b),decodeURIComponent(w))}}),a}function le(r){var a=new v,g=r.replace(/\r?\n[\t ]+/g," ");return g.split("\r").map(function(m){return m.indexOf(`
`)===0?m.substr(1,m.length):m}).forEach(function(m){var b=m.split(":"),w=b.shift().trim();if(w){var N=b.join(":").trim();a.append(w,N)}}),a}K.call(A.prototype);function P(r,a){if(!(this instanceof P))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');a||(a={}),this.type="default",this.status=a.status===void 0?200:a.status,this.ok=this.status>=200&&this.status<300,this.statusText=a.statusText===void 0?"":""+a.statusText,this.headers=new v(a.headers),this.url=a.url||"",this._initBody(r)}K.call(P.prototype),P.prototype.clone=function(){return new P(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},P.error=function(){var r=new P(null,{status:0,statusText:""});return r.type="error",r};var he=[301,302,303,307,308];P.redirect=function(r,a){if(he.indexOf(a)===-1)throw new RangeError("Invalid status code");return new P(null,{status:a,headers:{location:r}})},s.DOMException=c.DOMException;try{new s.DOMException}catch{s.DOMException=function(a,g){this.message=a,this.name=g;var m=Error(a);this.stack=m.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function z(r,a){return new Promise(function(g,m){var b=new A(r,a);if(b.signal&&b.signal.aborted)return m(new s.DOMException("Aborted","AbortError"));var w=new XMLHttpRequest;function N(){w.abort()}w.onload=function(){var O={status:w.status,statusText:w.statusText,headers:le(w.getAllResponseHeaders()||"")};O.url="responseURL"in w?w.responseURL:O.headers.get("X-Request-URL");var U="response"in w?w.response:w.responseText;setTimeout(function(){g(new P(U,O))},0)},w.onerror=function(){setTimeout(function(){m(new TypeError("Network request failed"))},0)},w.ontimeout=function(){setTimeout(function(){m(new TypeError("Network request failed"))},0)},w.onabort=function(){setTimeout(function(){m(new s.DOMException("Aborted","AbortError"))},0)};function de(O){try{return O===""&&c.location.href?c.location.href:O}catch{return O}}w.open(b.method,de(b.url),!0),b.credentials==="include"?w.withCredentials=!0:b.credentials==="omit"&&(w.withCredentials=!1),"responseType"in w&&(u.blob?w.responseType="blob":u.arrayBuffer&&b.headers.get("Content-Type")&&b.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(w.responseType="arraybuffer")),a&&typeof a.headers=="object"&&!(a.headers instanceof v)?Object.getOwnPropertyNames(a.headers).forEach(function(O){w.setRequestHeader(O,y(a.headers[O]))}):b.headers.forEach(function(O,U){w.setRequestHeader(U,O)}),b.signal&&(b.signal.addEventListener("abort",N),w.onreadystatechange=function(){w.readyState===4&&b.signal.removeEventListener("abort",N)}),w.send(typeof b._bodyInit>"u"?null:b._bodyInit)})}return z.polyfill=!0,c.fetch||(c.fetch=z,c.Headers=v,c.Request=A,c.Response=P),s.Headers=v,s.Request=A,s.Response=P,s.fetch=z,s})({})})(e),e.fetch.ponyfill=!0,delete e.fetch.polyfill;var n=t.fetch?t:e;i=n.fetch,i.default=n.fetch,i.fetch=n.fetch,i.Headers=n.Headers,i.Request=n.Request,i.Response=n.Response,f.exports=i}(D,D.exports)),D.exports}var Z;function Oe(){return Z||(Z=1,function(f,i){var t;if(typeof fetch=="function"&&(typeof S<"u"&&S.fetch?t=S.fetch:typeof window<"u"&&window.fetch?t=window.fetch:t=fetch),typeof Ee<"u"&&typeof window>"u"){var e=t||je();e.default&&(e=e.default),i.default=e,f.exports=i.default}}(B,B.exports)),B.exports}var ne=Oe();const ie=pe(ne),ee=ge({__proto__:null,default:ie},[ne]);function H(f){"@babel/helpers - typeof";return H=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},H(f)}var x;typeof fetch=="function"&&(typeof global<"u"&&global.fetch?x=global.fetch:typeof window<"u"&&window.fetch?x=window.fetch:x=fetch);var R;(typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":H(XMLHttpRequest))==="object")&&(typeof global<"u"&&global.XMLHttpRequest?R=global.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(R=window.XMLHttpRequest));var k;typeof ActiveXObject=="function"&&(typeof global<"u"&&global.ActiveXObject?k=global.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(k=window.ActiveXObject));!x&&ee&&!R&&!k&&(x=ie||ee);typeof x!="function"&&(x=void 0);var Pe=function(i,t,e,n){var o={};typeof window>"u"&&typeof global<"u"&&typeof global.process<"u"&&global.process.versions&&global.process.versions.node&&(o["User-Agent"]="i18next-locize-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),i.authorize&&i.apiKey&&(o.Authorization=i.apiKey),(e||i.setContentTypeJSON)&&(o["Content-Type"]="application/json");var s=function(u){var h=u.headers&&u.headers.get("x-cache")==="Error from cloudfront";if(!u.ok)return n(u.statusText||"Error",{status:u.status,resourceNotExisting:h});u.text().then(function(d){n(null,{status:u.status,data:d,resourceNotExisting:h})}).catch(n)};typeof fetch=="function"?fetch(t,{method:e?"POST":"GET",body:e?JSON.stringify(e):void 0,headers:o}).then(s).catch(n):x(t,{method:e?"POST":"GET",body:e?JSON.stringify(e):void 0,headers:o}).then(s).catch(n)},xe=function(i,t,e,n){try{var o;R?o=new R:o=new k("MSXML2.XMLHTTP.3.0"),o.open(e?"POST":"GET",t,1),i.crossDomain||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.authorize&&i.apiKey&&o.setRequestHeader("Authorization",i.apiKey),(e||i.setContentTypeJSON)&&o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){var s=o.getResponseHeader("x-cache")==="Error from cloudfront";o.readyState>3&&n(o.status>=400?o.statusText:null,{status:o.status,data:o.responseText,resourceNotExisting:s})},o.send(JSON.stringify(e))}catch(s){console&&console.log(s)}},M=function(i,t,e,n){if(typeof e=="function"&&(n=e,e=void 0),n=n||function(){},x)return Pe(i,t,e,n);if(typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":H(XMLHttpRequest))==="object"||typeof ActiveXObject=="function")return xe(i,t,e,n);n(new Error("No fetch and no xhr implementation found!"))};function _(f){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_(f)}function Ae(f,i){if(!(f instanceof i))throw new TypeError("Cannot call a class as a function")}function Le(f,i){for(var t=0;t<i.length;t++){var e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(f,_e(e.key),e)}}function Te(f,i,t){return i&&Le(f.prototype,i),Object.defineProperty(f,"prototype",{writable:!1}),f}function _e(f){var i=Ie(f,"string");return _(i)=="symbol"?i:i+""}function Ie(f,i){if(_(f)!="object"||!f)return f;var t=f[Symbol.toPrimitive];if(t!==void 0){var e=t.call(f,i);if(_(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}var qe=function(){return{loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,translatedPercentageThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:typeof window<"u"?!1:60*60*1e3,checkForProjectTimeout:3*1e3,storageExpiration:60*60*1e3,writeDebounce:5*1e3}},W;try{W=typeof window<"u"&&window.localStorage!==null;var te="notExistingLocizeProject";window.localStorage.setItem(te,"foo"),window.localStorage.removeItem(te)}catch{W=!1}function Se(f){var i=function(){},t=function(){};return W?(i=function(n){window.localStorage.setItem("notExistingLocizeProject_".concat(n),Date.now())},t=function(n){var o=window.localStorage.getItem("notExistingLocizeProject_".concat(n));return o?Date.now()-o>f?(window.localStorage.removeItem("notExistingLocizeProject_".concat(n)),!1):!0:!1}):typeof document<"u"&&(i=function(n){var o=new Date;o.setTime(o.getTime()+f);var s="; expires=".concat(o.toGMTString()),c="notExistingLocizeProject_".concat(n);try{document.cookie="".concat(c,"=").concat(Date.now()).concat(s,";path=/")}catch{}},t=function(n){var o="notExistingLocizeProject_".concat(n),s="".concat(o,"=");try{for(var c=document.cookie.split(";"),u=0;u<c.length;u++){for(var h=c[u];h.charAt(0)===" ";)h=h.substring(1,h.length);if(h.indexOf(s)===0)return!0}}catch{}return!1}),{setProjectNotExisting:i,isProjectNotExisting:t}}var F=function(i,t,e){var n={};return t.authorize&&t.apiKey&&(n.Authorization=t.apiKey),(e||t.setContentTypeJSON)&&(n["Content-Type"]="application/json"),{method:e?"POST":"GET",url:i,headers:n,body:e}},X=function(i,t,e){if(i.request.length===1){try{var n=i.request(t);n&&typeof n.then=="function"?n.then(function(o){return e(null,o)}).catch(e):e(null,n)}catch(o){e(o)}return}i.request(t,e)},Re=function(){function f(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;Ae(this,f),this.services=i,this.options=t,this.allOptions=e,this.type="backend",i&&i.projectId?this.init(null,i,e,t):this.init(i,t,e,n)}return Te(f,[{key:"init",value:function(t){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;!n.referenceLng&&o.fallbackLng&&Array.isArray(o.fallbackLng)&&o.fallbackLng[0]!=="dev"&&(n.referenceLng=o.fallbackLng[0]),this.services=t;var c=qe(),u=T(n,this.options||{});u.reloadInterval&&u.reloadInterval<5*60*1e3&&(console.warn("Your configured reloadInterval option is to low."),u.reloadInterval=c.reloadInterval),this.options=T(n,this.options||{},c),this.allOptions=o,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=Se(this.options.storageExpiration),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');var h=typeof window<"u"&&window.location&&window.location.hostname;h?(this.isAddOrUpdateAllowed=typeof this.options.allowedAddOrUpdateHosts=="function"?this.options.allowedAddOrUpdateHosts(h):this.options.allowedAddOrUpdateHosts.indexOf(h)>-1,t&&t.logger&&(o.saveMissing||o.updateMissing)&&(this.isAddOrUpdateAllowed?h!=="localhost"&&t.logger.warn('locize-backend: you are using the save or update missings feature from this host "'.concat(h,`".
Make sure you will not use it in production!
https://docs.locize.com/guides-tips-and-tricks/going-production`)):t.logger.warn(typeof this.options.allowedAddOrUpdateHosts=="function"?'locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "'.concat(h,'".'):'locize-backend: will not save or update missings because the host "'.concat(h,'" was not in the list of allowedAddOrUpdateHosts: ').concat(this.options.allowedAddOrUpdateHosts.join(", ")," (matches need to be exact).")))):this.isAddOrUpdateAllowed=!0,typeof s=="function"&&this.getOptions(function(d,l,p){if(d)return s(d);e.options.referenceLng=n.referenceLng||l.referenceLng||e.options.referenceLng,s(null,l,p)}),this.queuedWrites={pending:{}},this.debouncedProcess=we(this.process,this.options.writeDebounce),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&this.options.projectId&&(this.interval=setInterval(function(){return e.reload()},this.options.reloadInterval),_(this.interval)==="object"&&typeof this.interval.unref=="function"&&this.interval.unref())}},{key:"reload",value:function(){var t=this,e=this.services||{logger:console},n=e.backendConnector,o=e.languageUtils,s=e.logger;if(n){var c=n.language;if(!(c&&c.toLowerCase()==="cimode")){var u=[],h=function(l){var p=o.toResolveHierarchy(l);p.forEach(function(y){u.indexOf(y)<0&&u.push(y)})};h(c),this.allOptions.preload&&this.allOptions.preload.forEach(function(d){return h(d)}),u.forEach(function(d){t.allOptions.ns.forEach(function(l){n.read(d,l,"read",null,null,function(p,y){p&&s.warn("loading namespace ".concat(l," for language ").concat(d," failed"),p),!p&&y&&s.log("loaded namespace ".concat(l," for language ").concat(d),y),n.loaded("".concat(d,"|").concat(l),p,y)})})})}}}},{key:"getLanguages",value:function(t){var e=this,n;t||(n=Q(),t=function(u,h){if(u)return n.reject(u);n.resolve(h)});var o=q(this.options,["projectId"]);if(o)return t(new Error(o));var s=I(this.options.getLanguagesPath,{projectId:this.options.projectId});if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting)return t(new Error("locize project ".concat(this.options.projectId," does not exist!")));if(this.getLanguagesCalls=this.getLanguagesCalls||[],this.getLanguagesCalls.push(t),!(this.getLanguagesCalls.length>1))return this.loadUrl({},s,function(c,u,h){if(!e.somethingLoaded&&h&&h.resourceNotExisting){e.isProjectNotExisting=!0,e.storage.setProjectNotExisting(e.options.projectId);var d=new Error("locize project ".concat(e.options.projectId," does not exist!")),l=e.getLanguagesCalls;return e.getLanguagesCalls=[],l.forEach(function(E){return E(d)})}if(u){var p=Object.keys(u).reduce(function(E,v){var j=u[v];return j.isReferenceLanguage&&(E=v),E},"");p&&e.options.referenceLng!==p&&(e.options.referenceLng=p)}e.somethingLoaded=!0;var y=e.getLanguagesCalls;e.getLanguagesCalls=[],y.forEach(function(E){return E(c,u)})}),n}},{key:"getOptions",value:function(t){var e=this,n;return t||(n=Q(),t=function(s,c){if(s)return n.reject(s);n.resolve(c)}),this.getLanguages(function(o,s){if(o)return t(o);var c=Object.keys(s);if(!c.length)return t(new Error("was unable to load languages via API"));var u=c.reduce(function(d,l){var p=s[l];return p.translated[e.options.version]&&p.translated[e.options.version]>=e.options.translatedPercentageThreshold&&d.push(l),d},[]),h=c.reduce(function(d,l){return l.indexOf("-")>-1?!0:d},!1);t(null,{fallbackLng:e.options.referenceLng,referenceLng:e.options.referenceLng,supportedLngs:u,load:h?"all":"languageOnly"},s)}),n}},{key:"checkIfProjectExists",value:function(t){var e=this,n=this.services||{logger:console},o=n.logger;if(this.somethingLoaded){t&&t(null);return}if(this.alreadyRequestedCheckIfProjectExists){setTimeout(function(){return e.checkIfProjectExists(t)},this.options.checkForProjectTimeout);return}this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages(function(s){s&&s.message&&s.message.indexOf("does not exist")>0&&o&&o.error(s.message),t&&t(s)})}},{key:"read",value:function(t,e,n){var o=this,s=this.services||{logger:console},c=s.logger,u,h={};if(this.options.private){var d=q(this.options,["projectId","version","apiKey"]);if(d)return n(new Error(d),!1);u=I(this.options.privatePath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),h={authorize:!0}}else{var l=q(this.options,["projectId","version"]);if(l)return n(new Error(l),!1);u=I(this.options.loadPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){var p=new Error("locize project ".concat(this.options.projectId," does not exist!"));c&&c.error(p.message),n&&n(p);return}this.loadUrl(h,u,function(y,E,v){o.somethingLoaded||(v&&v.resourceNotExisting?setTimeout(function(){return o.checkIfProjectExists()},o.options.checkForProjectTimeout):o.somethingLoaded=!0),n(y,E)})}},{key:"loadUrl",value:function(t,e,n,o){var s=this;t=T(t,this.options),typeof n=="function"&&(o=n,n=void 0),o=o||function(){};var c=function(d,l){var p=l&&l.resourceNotExisting;if(l&&(l.status===408||l.status===400))return o("failed loading "+e,!0,{resourceNotExisting:p});if(l&&(l.status>=500&&l.status<600||!l.status))return o("failed loading "+e,!0,{resourceNotExisting:p});if(l&&l.status>=400&&l.status<500)return o("failed loading "+e,!1,{resourceNotExisting:p});if(!l&&d&&d.message&&d.message.indexOf("Failed to fetch")>-1)return o("failed loading "+e,!0,{resourceNotExisting:p});if(d)return o(d,!1);var y,E;try{typeof l.data=="string"?y=JSON.parse(l.data):y=l.data}catch{E="failed parsing "+e+" to json"}if(E)return o(E,!1);if(s.options.failLoadingOnEmptyJSON&&!Object.keys(y).length)return o("loaded result empty for "+e,!1,{resourceNotExisting:p});o(null,y,{resourceNotExisting:p})};if(!this.options.request||e.indexOf("/languages/".concat(t.projectId))>0)return M(t,e,n,c);var u=F(e,t,n);X(this.options,u,c)}},{key:"create",value:function(t,e,n,o,s,c){var u=this;typeof s!="function"&&(s=function(){}),this.checkIfProjectExists(function(h){if(h)return s(h);var d=q(u.options,["projectId","version","apiKey","referenceLng"]);if(d)return s(new Error(d));if(!u.isAddOrUpdateAllowed)return s("host is not allowed to create key.");typeof t=="string"&&(t=[t]),t.filter(function(l){return l===u.options.referenceLng}).length<1&&u.services&&u.services.logger&&u.services.logger.warn('locize-backend: will not save missings because the reference language "'.concat(u.options.referenceLng,'" was not in the list of to save languages: ').concat(t.join(", ")," (open your site in the reference language to save missings).")),t.forEach(function(l){l===u.options.referenceLng&&u.queue.call(u,u.options.referenceLng,e,n,o,s,c)})})}},{key:"update",value:function(t,e,n,o,s,c){var u=this;typeof s!="function"&&(s=function(){}),this.checkIfProjectExists(function(h){if(h)return s(h);var d=q(u.options,["projectId","version","apiKey","referenceLng"]);if(d)return s(new Error(d));if(!u.isAddOrUpdateAllowed)return s("host is not allowed to update key.");c||(c={}),typeof t=="string"&&(t=[t]),c.isUpdate=!0,t.forEach(function(l){l===u.options.referenceLng&&u.queue.call(u,u.options.referenceLng,e,n,o,s,c)})})}},{key:"writePage",value:function(t,e,n,o){var s=I(this.options.addPath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),c=I(this.options.updatePath,{lng:t,ns:e,projectId:this.options.projectId,version:this.options.version}),u=!1,h=!1,d={},l={};n.forEach(function(j){var L=j.options&&j.options.tDescription?{value:j.fallbackValue||"",context:{text:j.options.tDescription}}:j.fallbackValue||"";j.options&&j.options.isUpdate?(h||(h=!0),l[j.key]=L):(u||(u=!0),d[j.key]=L)});var p=0;u&&p++,h&&p++;var y=function(L){p--,p||o(L)};if(p||y(),u)if(!this.options.request)M(T({authorize:!0},this.options),s,d,y);else{var E=F(s,T({authorize:!0},this.options),d);X(this.options,E,y)}if(h)if(!this.options.request)M(T({authorize:!0},this.options),c,l,y);else{var v=F(c,T({authorize:!0},this.options),l);X(this.options,v,y)}}},{key:"write",value:function(t,e){var n=this,o=V(this.queuedWrites,["locks",t,e]);if(!o){var s=V(this.queuedWrites,[t,e]);C(this.queuedWrites,[t,e],[]);var c=1e3,u=s.filter(function(y){return y.callback}).map(function(y){return y.callback});if(s.length){C(this.queuedWrites,["locks",t,e],!0);var h=function(){C(n.queuedWrites,["locks",t,e],!1),u.forEach(function(E){return E()}),n.options.onSaved&&n.options.onSaved(t,e),n.debouncedProcess(t,e)},d=s.length/c,l=0,p=s.splice(0,c);for(this.writePage(t,e,p,function(){l++,l>=d&&h()});p.length===c;)p=s.splice(0,c),p.length&&this.writePage(t,e,p,function(){l++,l>=d&&h()})}}}},{key:"process",value:function(){var t=this;Object.keys(this.queuedWrites).forEach(function(e){e!=="locks"&&Object.keys(t.queuedWrites[e]).forEach(function(n){var o=t.queuedWrites[e][n];o.length&&t.write(e,n)})})}},{key:"queue",value:function(t,e,n,o,s,c){me(this.queuedWrites,[t,e],{key:n,fallbackValue:o||"",callback:s,options:c}),this.debouncedProcess()}}])}();Re.type="backend";export{Re as default};
